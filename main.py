from fastapi import FastAPI

from db_handler.db_handler.function.query_builder_function import QueryBuilderFunction
from db_handler.db_handler.function.record_builder_function import RecordBuilderFunction
from db_handler.db_handler.service.database_initializer_service import DatabaseInitializerService
from db_handler.db_handler.service.database_query_service import DatabaseQueryService
from db_handler.db_handler.util.database_utils import DatabaseUtils
from predictor_api.predictor_api.controller.knockout_template_controller import KnockoutTemplateController
from predictor_api.predictor_api.controller.league_template_controller import LeagueTemplateController
from predictor_api.predictor_api.controller.tournament_controller import TournamentController
from predictor_api.predictor_api.controller.tournament_template_controller import TournamentTemplateController
from predictor_api.predictor_api.service.knockout_template_service import KnockoutTemplateService
from predictor_api.predictor_api.service.league_template_service import LeagueTemplateService
from predictor_api.predictor_api.service.tournament_service import TournamentService
from predictor_api.predictor_api.service.tournament_template_service import TournamentTemplateService
from predictor_api.predictor_api.util.predictor_constants import PredictorConstants

app = FastAPI()

database_initializer_service: DatabaseInitializerService = DatabaseInitializerService(DatabaseUtils.DATABASE_CONNECTION, PredictorConstants.PREDICTOR_SCHEMA)
database_initializer_service.initialize_tables()

database_query_service: DatabaseQueryService = DatabaseQueryService(DatabaseUtils.DATABASE_CONNECTION, QueryBuilderFunction(), RecordBuilderFunction())

app.include_router(TournamentController(TournamentService(database_query_service)).router)
app.include_router(TournamentTemplateController(TournamentTemplateService(database_query_service)).router)
app.include_router(LeagueTemplateController(LeagueTemplateService(database_query_service)).router)
app.include_router(KnockoutTemplateController(KnockoutTemplateService(database_query_service)).router)
